<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å¸«åŒ ã‚¢ãƒ—ãƒª v1.3 â€” æŠ•è³‡ãƒãƒ£ãƒƒãƒˆ / ã‚·ãƒŸãƒ¥ / ã‚¯ã‚¤ã‚º</title>
<meta name="theme-color" content="#0b0f14" />
<style>
:root{--bg:#0b0f14;--panel:#111824;--soft:#0e1520;--text:#e8f0ff;--muted:#9fb3c8;--accent:#5ad1ff;--accent2:#7cffc2;--border:#233043;--ok:#64f4a3;--warn:#ffd36e;--bad:#ff6b6b}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif}
header{position:sticky;top:0;z-index:10;padding:14px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(90,209,255,.08),rgba(124,255,194,.05))}
h1{margin:0;font-size:clamp(18px,3.2vw,28px)} .sub{color:var(--muted);font-size:12px}
.container{max-width:1100px;margin:0 auto;padding:16px}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 12px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:var(--soft);cursor:pointer;flex:0 0 auto}
.tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001018;border-color:transparent}
.panel{display:none} .panel.active{display:block}
.card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
input,select,button{background:var(--soft);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
button{cursor:pointer;border:1px solid transparent;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001018;font-weight:700;min-height:44px;border-radius:12px}
button.secondary{background:transparent;color:var(--text);border-color:var(--border)}
.small{font-size:12px;color:var(--muted)} .tag{padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--muted);display:inline-block}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border)}
hr{border:0;border-top:1px dashed var(--border);margin:10px 0}
/* Chat */
.chat-wrap{display:grid;grid-template-rows:1fr auto;gap:10px;height:calc(var(--vh, 1vh)*70)}
.msgs{overflow:auto;padding-right:4px}
.msg{display:flex;gap:10px;margin:10px 0}
.bubble{max-width:80%;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:var(--soft)}
.me .bubble{margin-left:auto;background:#112235}
.sensei .bubble{background:#0f1d24}
.quick{display:flex;gap:6px;flex-wrap:wrap}
.quick button{padding:8px 10px}
/* Chart */
canvas{width:100%;height:260px;background:var(--soft);border:1px solid var(--border);border-radius:12px;display:block}
/* Mobile */
@media (max-width:520px){
  body{font-size:15px}
  header{padding:12px} .container{padding:12px}
  .card{padding:12px;border-radius:12px} .row{gap:8px}
  input,select,button{padding:12px;font-size:16px}
  #chat .card>div:last-child{position:sticky;bottom:0;background:linear-gradient(180deg,rgba(11,15,20,0),rgba(11,15,20,.85));padding-bottom:max(8px,env(safe-area-inset-bottom))}
  canvas{height:220px}
}
</style>
</head>
<body>
<header>
  <h1>å¸«åŒ ã‚¢ãƒ—ãƒª v1.3 <span class="badge">æŠ•è³‡ãƒãƒ£ãƒƒãƒˆ</span> <span class="badge">ã‚·ãƒŸãƒ¥</span> <span class="badge">ã‚¯ã‚¤ã‚º</span></h1>
  <div class="sub">æ•™è‚²ç›®çš„ã®ä¸€èˆ¬æƒ…å ±ã€‚ç‰¹å®šéŠ˜æŸ„ã®æ¨å¥¨ã¯è¡Œã„ã¾ã›ã‚“ã€‚</div>
</header>

<div class="container">
  <div class="tabs">
    <div class="tab active" data-tab="chat">ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</div>
    <div class="tab" data-tab="sim">ğŸ“Š ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
    <div class="tab" data-tab="quiz">ğŸ§ª ã‚¯ã‚¤ã‚º</div>
    <div class="tab" data-tab="profile">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
  </div>

  <!-- Chat -->
  <section id="chat" class="panel active">
    <div class="card chat-wrap">
      <div id="msgs" class="msgs"></div>
      <div>
        <div class="quick">
          <button class="secondary q">åˆå¿ƒè€…ã¯ä½•ã‹ã‚‰å§‹ã‚ã‚‹ï¼Ÿ</button>
          <button class="secondary q">æ”»ã‚ãŸã„æ™‚ã®é…åˆ†ã¯ï¼Ÿ</button>
          <button class="secondary q">é…å½“é‡è¦–ã ã¨ï¼Ÿ</button>
        </div>
        <div class="row" style="margin-top:8px">
          <input id="chatInput" placeholder="ä»Šè²·ã†ãªã‚‰ä½•ï¼Ÿ/åˆå¿ƒè€…/æ”»ã‚ãŸã„/é…å½“ãªã©" style="flex:1" autocomplete="off" enterkeyhint="send">
          <button id="sendBtn">é€ä¿¡</button>
        </div>
        <div class="small">â€» å›ç­”ã¯ã‚«ãƒ†ã‚´ãƒªææ¡ˆï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹/é…å½“/ã‚°ãƒ­ãƒ¼ã‚¹ï¼‰ã§ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã€‚</div>
      </div>
    </div>
  </section>

  <!-- Simulator -->
  <section id="sim" class="panel">
    <div class="card">
      <h2 style="margin:0 0 8px">NISA / ç©ç«‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
      <div class="row">
        <div><label>æ¯æœˆ(å††)</label><input id="pmt" type="number" inputmode="numeric" value="30000"></div>
        <div><label>å¹´ç‡(%)</label><input id="ret" type="number" inputmode="decimal" value="5"></div>
        <div><label>å¹´æ•°</label><input id="yrs" type="number" inputmode="numeric" value="10"></div>
        <button id="runSim" class="secondary">è¨ˆç®—</button>
      </div>
      <div class="row" style="margin-top:6px"><div class="tag" id="outSim"></div></div>
      <canvas id="chartSim"></canvas>
    </div>
  </section>

  <!-- Quiz -->
  <section id="quiz" class="panel">
    <div class="card">
      <h2 style="margin:0 0 6px">ãƒŸãƒ‹ã‚¯ã‚¤ã‚ºï¼ˆ5å•ï¼‰</h2>
      <div id="quizBox"></div>
      <button id="grade" class="secondary">æ¡ç‚¹ã™ã‚‹</button>
      <div id="score" class="tag" style="margin-top:8px"></div>
    </div>
  </section>

  <!-- Profile -->
  <section id="profile" class="panel">
    <div class="card">
      <h2 style="margin:0 0 6px">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå›ç­”ã«åæ˜ ï¼‰</h2>
      <div class="row">
        <div><label>å¹´é½¢</label><input id="age" type="number" inputmode="numeric" value="20"></div>
        <div><label>æŠ•è³‡æœŸé–“ï¼ˆå¹´ï¼‰</label><input id="horizon" type="number" inputmode="numeric" value="10"></div>
        <div><label>æ¯æœˆã®æŠ•è³‡ä½™åŠ›ï¼ˆå††ï¼‰</label><input id="budget" type="number" inputmode="numeric" value="10000"></div>
        <div><label>ãƒªã‚¹ã‚¯è¨±å®¹åº¦</label>
          <select id="risk"><option>ä½</option><option selected>ä¸­</option><option>é«˜</option></select>
        </div>
        <button id="saveProf" class="secondary">ä¿å­˜</button>
      </div>
      <div class="small" id="profOut"></div>
    </div>
  </section>
</div>

<script>
/* ===== 100vhè£œæ­£ï¼ˆã‚¹ãƒãƒ›ï¼‰ ===== */
(function setVh(){ const set=()=>document.documentElement.style.setProperty('--vh', `${window.innerHeight*0.01}px`); set(); addEventListener('resize',set); addEventListener('orientationchange',set); })();

/* ===== Tabs ===== */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    t.classList.add('active'); document.getElementById(t.dataset.tab).classList.add('active');
  });
});

/* ===== Profile ===== */
const PK='mentor_profile_v13';
let PROF = JSON.parse(localStorage.getItem(PK)||'{"age":20,"horizon":10,"budget":10000,"risk":"ä¸­"}');
function saveProf(){ localStorage.setItem(PK, JSON.stringify(PROF)); showProf(); }
function showProf(){ document.getElementById('profOut').textContent = `å¹´é½¢:${PROF.age} / æœŸé–“:${PROF.horizon}å¹´ / ä½™åŠ›:Â¥${(+PROF.budget).toLocaleString()} / ãƒªã‚¹ã‚¯:${PROF.risk}`; }
['age','horizon','budget','risk'].forEach(id=> document.getElementById(id).value = PROF[id]);
document.getElementById('saveProf').addEventListener('click', ()=>{
  PROF.age=+document.getElementById('age').value||20;
  PROF.horizon=+document.getElementById('horizon').value||10;
  PROF.budget=+document.getElementById('budget').value||0;
  PROF.risk=document.getElementById('risk').value||'ä¸­';
  saveProf();
}); showProf();

/* ===== Chatï¼ˆã‚«ãƒ†ã‚´ãƒªæ–‡å­—ã§è¿”ç­”ï¼‰ ===== */
const msgs = document.getElementById('msgs');
const yen = n => 'Â¥'+Math.round(n).toLocaleString('ja-JP');
function addMsg(role, html){
  const wrap=document.createElement('div'); wrap.className='msg '+(role==='me'?'me':'sensei');
  const b=document.createElement('div'); b.className='bubble'; b.innerHTML=html; wrap.appendChild(b);
  msgs.appendChild(wrap); msgs.scrollTop=msgs.scrollHeight;
}
// ---- ç½®æ›ãƒ‘ãƒƒãƒï¼šã‚«ãƒ†ã‚´ãƒªææ¡ˆã®åˆ¤å®šã‚’å¼·åŒ– ----
function categoryAdvice(question){
  const {horizon,budget,risk}=PROF;

  // 1) æ–‡å­—æ­£è¦åŒ–ï¼ˆå…¨è§’â†’åŠè§’ã€å¥èª­ç‚¹ãƒ»ç©ºç™½é™¤å»ï¼‰
  const norm = (s)=>
    s.normalize('NFKC')
     .replace(/[ï¼!ï¼Ÿ?\s]/g,'')
     .toLowerCase();

  const q = norm(question);

  // 2) æ„å›³åˆ¤å®šï¼ˆå¹…åºƒã„è¨€ã„å›ã—ã‚’ã‚«ãƒãƒ¼ï¼‰
  const isBeginner = /(åˆå¿ƒè€…|ã¯ã˜ã‚|åˆã‚ã¦|å…¥é–€|ä½•ã‹ã‚‰|ã‚€ãšã„|é›£ã—ã„|æ¥½ã«|ç°¡å˜ã«)/.test(q);
  const isAttack   = /(æ”»ã‚|å¼·æ°—|ã‚°ãƒ­ãƒ¼ã‚¹|æˆé•·|ãƒªã‚¹ã‚¯å–|ä¸€ç™º|å€|è·³ã­|ãƒ†ãƒ¼ãƒ)/.test(q);
  const isDividend = /(é…å½“|åˆ©å›ã‚Š|ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚·ãƒ–|å®ˆã‚Š|å®‰å®š|é«˜é…å½“|ã‚¤ãƒ³ã‚«ãƒ )/.test(q);

  // 3) é…åˆ†ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆãƒªã‚¹ã‚¯ãƒ»æœŸé–“ã§å¾®èª¿æ•´ï¼‰
  let beginner={idx:100,div:0,gro:0},
      normal  ={idx:75, div:15,gro:10},
      attack  ={idx:60, div:20,gro:20};

  if(risk==='ä½'){ normal={idx:85,div:10,gro:5};  attack={idx:70,div:20,gro:10}; }
  if(risk==='é«˜'){ normal={idx:65,div:10,gro:25}; attack={idx:50,div:15,gro:35}; }
  if(horizon<3){  beginner={idx:100,div:0,gro:0}; normal={idx:90,div:10,gro:0}; attack={idx:80,div:20,gro:0}; }

  const yen = n=>'Â¥'+Math.round(n).toLocaleString('ja-JP');
  const block=(title,p)=>`
    <div class="card" style="margin:8px 0;background:rgba(90,209,255,.04)">
      <div><b>${title}</b></div>
      <ul class="small">
        <li>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ETFï¼š<b>${p.idx}%</b>${budget?` â†’ ${yen(budget*p.idx/100)}/æœˆ`:''}</li>
        <li>é…å½“/ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚·ãƒ–ï¼š<b>${p.div}%</b>${budget?` â†’ ${yen(budget*p.div/100)}/æœˆ`:''}</li>
        <li>ã‚°ãƒ­ãƒ¼ã‚¹/ãƒ†ãƒ¼ãƒï¼š<b>${p.gro}%</b>${budget?` â†’ ${yen(budget*p.gro/100)}/æœˆ`:''}</li>
      </ul>
      <div class="small">è²·ã„æ–¹ï¼šæ¯æœˆåŒé¡DCAã€‚ã¾ã¨ã¾ã£ã¦è²·ã†ãªã‚‰<b>3åˆ†å‰²</b>ã€‚</div>
    </div>`;

  const pre = `<div class="small">å‰æ: æœŸé–“<strong>${horizon}å¹´</strong> / æœˆ<strong>${yen(budget||0)}</strong> / ãƒªã‚¹ã‚¯<strong>${risk}</strong></div><hr>`;

  // 4) æ„å›³ã«å¿œã˜ã¦åˆ†å²
  if(isBeginner){
    return pre + `<b>çµè«–ï¼š</b>åˆå¿ƒè€…ã¯<b>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ETF</b>ã‚’è»¸ã«ã€‚` + block('åˆå¿ƒè€…å‘ã‘', beginner);
  }
  if(isAttack){
    return pre + `<b>çµè«–ï¼š</b>æ”»ã‚ãŸã„ãªã‚‰<b>ã‚°ãƒ­ãƒ¼ã‚¹ã‚’20%å‰å¾Œ</b>ï¼ˆå…¥ã‚Œã™ãæ³¨æ„ï¼‰ã€‚` + block('æ”»ã‚ï¼ˆå€¤å‹•ãOKï¼‰', attack);
  }
  if(isDividend){
    return pre + `<b>çµè«–ï¼š</b>é…å½“ãƒ»å®‰å®šé‡è¦–ã€‚` + block('å®ˆã‚Šå¯„ã‚Šï¼ˆé…å½“é‡è¦–ï¼‰', {idx:80,div:20,gro:0});
  }

  // 5) è©²å½“ãªã— â†’ 3ãƒ‘ã‚¿ãƒ¼ãƒ³æç¤º
  return pre + `<b>ä»Šæ—¥ã®çµè«–ï¼ˆ3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ï¼š</b>`
       + block('åˆå¿ƒè€…å‘ã‘', beginner)
       + block('æ¨™æº–ï¼ˆã¡ã‚‡ã„æ”»ã‚ï¼‰', normal)
       + block('æ”»ã‚ï¼ˆå€¤å‹•ãOKï¼‰', attack)
       + `<div class="small">â€»ã‚«ãƒ†ã‚´ãƒªææ¡ˆã€‚éŠ˜æŸ„æŒ‡å®šã‚„æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
}

function send(text){ addMsg('me',text); setTimeout(()=>addMsg('sensei', categoryAdvice(text)), 120); }
const inputEl=document.getElementById('chatInput'); let composing=false;
inputEl.addEventListener('compositionstart',()=>composing=true);
inputEl.addEventListener('compositionend', ()=>composing=false);
inputEl.addEventListener('keydown',e=>{
  if(e.key==='Enter' && !e.shiftKey){
    if(composing || e.isComposing) return; e.preventDefault();
    const v=inputEl.value.trim(); if(v) send(v); inputEl.value='';
  }
});
document.getElementById('sendBtn').addEventListener('click',()=>{ const v=inputEl.value.trim(); if(v) send(v); inputEl.value=''; });
document.querySelectorAll('.q').forEach(b=> b.addEventListener('click',()=> send(b.textContent)));
addMsg('sensei','ã‚ˆã†ã€‚è³ªå•ãã‚ŒãŸã‚‰ <b>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹/é…å½“/ã‚°ãƒ­ãƒ¼ã‚¹</b>ã§é…åˆ†ï¼ˆå††ã¾ã§ï¼‰ã‚’è¿”ã™ã§ã€‚');

/* ===== Simulator ===== */
function runDCA(m,yrs,annual){ const n=Math.max(1,Math.round(yrs*12)); const r=(annual/100)/12; let v=0,arr=[]; for(let i=1;i<=n;i++){ v=(v+m)*(1+r); arr.push(Math.round(v)); } return arr; }
function drawChart(c,series){
  const ctx=c.getContext('2d'), DPR=window.devicePixelRatio||1, W=c.clientWidth, H=c.clientHeight;
  c.width=W*DPR; c.height=H*DPR; ctx.scale(DPR,DPR); ctx.clearRect(0,0,W,H);
  const pad=36, maxY=Math.max(...series)*1.05||1;
  ctx.strokeStyle="#233043"; ctx.beginPath(); ctx.moveTo(pad,H-pad); ctx.lineTo(W-pad,H-pad); ctx.lineTo(W-pad,pad); ctx.stroke();
  ctx.fillStyle="#9fb3c8"; ctx.font="12px system-ui";
  for(let t=0;t<=4;t++){ const y=H-pad-(H-2*pad)*t/4; const v=Math.round(maxY*t/4); ctx.fillText(v.toLocaleString('ja-JP'),6,y+4); ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(W-pad,y); ctx.strokeStyle="#233043"; ctx.stroke(); }
  ctx.beginPath(); series.forEach((v,i)=>{ const x=pad+(W-2*pad)*i/(series.length-1); const y=H-pad-(H-2*pad)*(v/maxY); i?ctx.lineTo(x,y):ctx.moveTo(x,y); });
  ctx.strokeStyle="#7aa2ff"; ctx.lineWidth=2; ctx.stroke();
}
document.getElementById('runSim').addEventListener('click',()=>{
  const m=+document.getElementById('pmt').value||0, r=+document.getElementById('ret').value||0, y=+document.getElementById('yrs').value||0;
  const arr=runDCA(m,y,r), last=arr[arr.length-1]||0, principal=m*Math.round(y*12);
  document.getElementById('outSim').textContent=`å…ƒæœ¬ ${yen(principal)} / è©•ä¾¡é¡ ${yen(last)} / åˆ©ç›Š ${yen(last-principal)}`;
  drawChart(document.getElementById('chartSim'), arr);
});

/* ===== Quiz ===== */
const QA=[
 {q:"NISAã§åŸºæœ¬çš„ã«ç‹™ã†ã¹ãã¯ï¼Ÿ",a:["çŸ­æœŸå£²è²·","é•·æœŸãƒ»åˆ†æ•£ãƒ»ä½ã‚³ã‚¹ãƒˆ","ä¸€ç‚¹é›†ä¸­"],c:1},
 {q:"DCAã¨ã¯ï¼Ÿ",a:["æ¯æœˆä¸€å®šé¡ã§è²·ã†","æœ€å®‰ã®æ—¥ã ã‘è²·ã†","é«˜é…å½“ã ã‘è²·ã†"],c:0},
 {q:"é«˜ãƒœãƒ©è³‡ç”£ã®å§¿å‹¢ã¯ï¼Ÿ",a:["è³‡ç”£ã®å¤§åŠã‚’å…¥ã‚Œã‚‹","å€Ÿé‡‘ã—ã¦å…¨åŠ›","ä¸Šé™å‰²åˆã‚’æ±ºã‚å°‘é¡ã§"],c:2},
 {q:"ç”Ÿæ´»é˜²è¡›è³‡é‡‘ã®ç›®å®‰ã¯ï¼Ÿ",a:["1é€±é–“åˆ†","3ã€œ6ã‹æœˆåˆ†","10å¹´åˆ†"],c:1},
 {q:"åˆ†æ•£ãŒåºƒã„ã®ã¯ï¼Ÿ",a:["å˜ä¸€éŠ˜æŸ„","ãƒ†ãƒ¼ãƒç‰¹åŒ–","å…¨ä¸–ç•Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹"],c:2},
];
function renderQuiz(){
  const box=document.getElementById('quizBox'); box.innerHTML="";
  QA.forEach((it,i)=>{
    const div=document.createElement('div'); div.className="quiz-q";
    div.innerHTML=`<div>${i+1}. ${it.q}</div>`+it.a.map((t,j)=>`<label class="opt"><input type="radio" name="q${i}" value="${j}"> ${t}</label>`).join("");
    box.appendChild(div);
  });
}
document.getElementById('grade').addEventListener('click',()=>{
  let score=0; QA.forEach((it,i)=>{ const v=document.querySelector(`input[name="q${i}"]:checked`); if(v&&+v.value===it.c) score++; });
  document.getElementById('score').textContent=`æ­£è§£ï¼š${score}/${QA.length} ç‚¹`;
});
renderQuiz();

/* ===== ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«éš ã‚Œãªã„ã‚ˆã†ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« ===== */
['chatInput','pmt','ret','yrs','age','horizon','budget'].forEach(id=>{
  const el=document.getElementById(id); if(!el) return;
  el.addEventListener('focus', ()=> setTimeout(()=> el.scrollIntoView({block:'end',behavior:'smooth'}), 120));
});
</script>
</body>
</html>
