<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å¸«åŒ ã‚¢ãƒ—ãƒª v1.1 â€” æŠ•è³‡ãƒãƒ£ãƒƒãƒˆ & ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<meta name="theme-color" content="#0b0f14" />
<style>
:root{--bg:#0b0f14;--panel:#111824;--soft:#0e1520;--text:#e8f0ff;--muted:#9fb3c8;--accent:#5ad1ff;--accent2:#7cffc2;--border:#233043;--ok:#64f4a3;--warn:#ffd36e;--bad:#ff6b6b}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif}
header{position:sticky;top:0;z-index:10;padding:14px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(90,209,255,.08),rgba(124,255,194,.05));backdrop-filter:blur(6px)}
h1{margin:0;font-size:clamp(18px,3.2vw,28px)} .sub{color:var(--muted);font-size:12px}
.container{max-width:1100px;margin:0 auto;padding:16px}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 12px}
.tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:var(--soft);cursor:pointer}
.tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001018;border-color:transparent}
.panel{display:none} .panel.active{display:block}
.card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
input,select,button,textarea{background:var(--soft);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
button{cursor:pointer;border:1px solid transparent;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001018;font-weight:700}
button.secondary{background:transparent;color:var(--text);border-color:var(--border)}
.small{font-size:12px;color:var(--muted)} .tag{padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--muted);display:inline-block}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border)}
summary{cursor:pointer} hr{border:0;border-top:1px dashed var(--border);margin:10px 0}
.chat-wrap{display:grid;grid-template-rows:1fr auto;gap:10px;height:min(68vh,620px)}
.msgs{overflow:auto;padding-right:4px}
.msg{display:flex;gap:10px;margin:10px 0}
.bubble{max-width:80%;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:var(--soft)}
.me .bubble{margin-left:auto;background:#112235}
.sensei .bubble{background:#0f1d24}
.quick{display:flex;gap:6px;flex-wrap:wrap}
.quick button{padding:6px 10px}
canvas{width:100%;height:260px;background:var(--soft);border:1px solid var(--border);border-radius:12px;display:block}
.grid{display:grid;gap:12px;grid-template-columns:1fr} @media(min-width:880px){.grid{grid-template-columns:1fr 1fr}}
.quiz-q{margin:10px 0} .opt{display:block;margin:6px 0}
.score{font-size:18px;font-weight:800}
</style>
</head>
<body>
<header>
  <h1>å¸«åŒ ã‚¢ãƒ—ãƒª v1.1 <span class="badge">æŠ•è³‡ãƒãƒ£ãƒƒãƒˆ</span> <span class="badge">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</span> <span class="badge">å­¦ç¿’ï¼†ã‚¯ã‚¤ã‚º</span></h1>
  <div class="sub">æ•™è‚²ç›®çš„ãƒ»ä¸€èˆ¬æƒ…å ±ã€‚ç‰¹å®šéŠ˜æŸ„ã®æ¨å¥¨ã¯è¡Œã„ã¾ã›ã‚“ã€‚</div>
</header>

<div class="container">
  <div class="tabs">
    <div class="tab active" data-tab="chat">ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</div>
    <div class="tab" data-tab="sim">ğŸ“Š ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
    <div class="tab" data-tab="learn">ğŸ“š å­¦ç¿’</div>
    <div class="tab" data-tab="quiz">ğŸ§ª ã‚¯ã‚¤ã‚º</div>
    <div class="tab" data-tab="profile">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
  </div>

  <!-- Chat -->
  <section id="chat" class="panel active">
    <div class="card chat-wrap">
      <div id="msgs" class="msgs"></div>
      <div>
        <div class="quick">
          <button class="secondary q">NISAã£ã¦ä½•è²·ãˆã°ï¼Ÿ</button>
          <button class="secondary q">ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³è²·ã†ã¹ãï¼Ÿ</button>
          <button class="secondary q">FXã§å¢—ã‚„ã›ã‚‹ï¼Ÿ</button>
        </div>
        <div class="row" style="margin-top:8px">
          <input id="chatInput" placeholder="å¸«åŒ ã«è³ªå•ã‚’æ›¸ãï¼ˆä¾‹ï¼šä»Š2434ã‚’1ä¸‡å††è²·ã£ã¦ã‚ˆã„ï¼Ÿï¼‰" style="flex:1" autocomplete="off" enterkeyhint="send">
          <button id="sendBtn">é€ä¿¡</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Simulator -->
  <section id="sim" class="panel">
    <div class="card">
      <h2>NISAã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
      <div class="row">
        <input id="pmt" type="number" value="30000" placeholder="æ¯æœˆç©ç«‹(å††)">
        <input id="ret" type="number" value="5" placeholder="å¹´ç‡(%)">
        <input id="yrs" type="number" value="10" placeholder="å¹´æ•°">
        <button id="runSim">è¨ˆç®—</button>
      </div>
      <div id="outSim" class="tag"></div>
      <canvas id="chartSim"></canvas>
    </div>
  </section>

  <!-- Profile -->
  <section id="profile" class="panel">
    <div class="card">
      <h2>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h2>
      <input id="age" type="number" value="20">
      <input id="horizon" type="number" value="10">
      <input id="budget" type="number" value="10000">
      <select id="risk"><option>ä½</option><option selected>ä¸­</option><option>é«˜</option></select>
      <button id="saveProf">ä¿å­˜</button>
      <div class="small" id="profOut"></div>
    </div>
  </section>
</div>

<script>
/* ==== Tabs ==== */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    t.classList.add('active');
    document.getElementById(t.dataset.tab).classList.add('active');
  });
});

/* ==== Profile ==== */
const PK='mentor_profile_v1';
let PROF = JSON.parse(localStorage.getItem(PK)||'{"age":20,"horizon":10,"budget":10000,"risk":"ä¸­"}');
function saveProf(){ localStorage.setItem(PK, JSON.stringify(PROF)); showProf(); }
function showProf(){ document.getElementById('profOut').textContent = `å¹´é½¢:${PROF.age} / æœŸé–“:${PROF.horizon}å¹´ / ä½™åŠ›:Â¥${(+PROF.budget).toLocaleString()} / ãƒªã‚¹ã‚¯:${PROF.risk}`; }
['age','horizon','budget','risk'].forEach(id=> document.getElementById(id).value = PROF[id]);
document.getElementById('saveProf').addEventListener('click', ()=>{
  PROF.age=+document.getElementById('age').value||20;
  PROF.horizon=+document.getElementById('horizon').value||10;
  PROF.budget=+document.getElementById('budget').value||0;
  PROF.risk=document.getElementById('risk').value||'ä¸­';
  saveProf();
});
showProf();

/* ==== Chat ==== */
const msgs = document.getElementById('msgs');
function addMsg(role, text){
  const wrap=document.createElement('div');
  wrap.className='msg '+(role==='me'?'me':'sensei');
  const bub=document.createElement('div');
  bub.className='bubble';
  bub.innerHTML=text;
  wrap.appendChild(bub);
  msgs.appendChild(wrap);
  msgs.scrollTop=msgs.scrollHeight;
}
function adviceFor(input){
  const q=input.replace(/\s+/g,'');
  const {horizon,budget,risk}=PROF;
  const wantBuy=/è²·/.test(input);
  const wantSell=/å£²|åˆ©ç¢º/.test(input);
  const verdict={label:'TRY',color:'#ffd36e',why:[],plan:[]};
  if(wantSell){verdict.label='TRY';verdict.color='#64f4a3';verdict.plan.push('åˆ©ç¢ºã¯äº‹å‰ãƒ«ãƒ¼ãƒ«é€šã‚Šã«');}
  else if(wantBuy){
    if(horizon>=5 && risk!=='ä½'){verdict.label='GO';verdict.color='#64f4a3';}
    else if(horizon<3||risk==='ä½'){verdict.label='PASS';verdict.color='#ff6b6b';}
    verdict.plan.push(`å°‘é¡åˆ†å‰²DCAã‚’æ¤œè¨ï¼ˆæœˆä½™åŠ›Â¥${budget.toLocaleString()})`);
  }
  return `<div>çµè«–:<span class="badge" style="background:${verdict.color}">${verdict.label}</span></div>`+
         (verdict.plan.length?`<ul class="small">`+verdict.plan.map(x=>`<li>${x}</li>`).join('')+`</ul>`:'');
}
function send(text){
  addMsg('me',text);
  setTimeout(()=>addMsg('sensei',adviceFor(text)),200);
}
const inputEl=document.getElementById('chatInput');
let composing=false;
inputEl.addEventListener('compositionstart',()=>composing=true);
inputEl.addEventListener('compositionend',()=>composing=false);
inputEl.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){
    if(composing||e.isComposing) return;
    e.preventDefault();
    const val=inputEl.value.trim();
    if(val) send(val);
    inputEl.value='';
  }
});
document.getElementById('sendBtn').addEventListener('click',()=>{
  const val=inputEl.value.trim(); if(val) send(val); inputEl.value='';
});

/* ==== Simulator ==== */
function runDCA(monthly,yrs,annual){
  const n=yrs*12; const r=annual/100/12; let v=0,arr=[];
  for(let i=1;i<=n;i++){v=(v+monthly)*(1+r);arr.push(v);}
  return arr;
}
document.getElementById('runSim').addEventListener('click',()=>{
  const m=+document.getElementById('pmt').value;
  const r=+document.getElementById('ret').value;
  const y=+document.getElementById('yrs').value;
  const arr=runDCA(m,y,r);
  document.getElementById('outSim').textContent=`æœ€çµ‚è³‡ç”£:Â¥${Math.round(arr[arr.length-1]).toLocaleString()}`;
  drawChart(document.getElementById('chartSim'),arr);
});
function drawChart(canvas,series){
  const ctx=canvas.getContext('2d');ctx.clearRect(0,0,canvas.width,canvas.height);
  canvas.width=canvas.clientWidth;canvas.height=canvas.clientHeight;
  ctx.beginPath();
  series.forEach((v,i)=>{let x=i/series.length*canvas.width,y=canvas.height-v/Math.max(...series)*canvas.height;
    if(i==0)ctx.moveTo(x,y);else ctx.lineTo(x,y);});
  ctx.strokeStyle="#5ad1ff";ctx.stroke();
}
</script>
</body>
</html>
