<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å¸«åŒ ã‚¢ãƒ—ãƒª v1 â€” æŠ•è³‡ãƒãƒ£ãƒƒãƒˆ & ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<link rel="manifest" href="manifest.webmanifest" />
<meta name="theme-color" content="#0b0f14" />
<style>
:root{--bg:#0b0f14;--panel:#111824;--soft:#0e1520;--text:#e8f0ff;--muted:#9fb3c8;--accent:#5ad1ff;--accent2:#7cffc2;--border:#233043;--ok:#64f4a3;--warn:#ffd36e;--bad:#ff6b6b}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif}
header{position:sticky;top:0;z-index:10;padding:14px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(90,209,255,.08),rgba(124,255,194,.05));backdrop-filter:blur(6px)}
h1{margin:0;font-size:clamp(18px,3.2vw,28px)} .sub{color:var(--muted);font-size:12px}
.container{max-width:1100px;margin:0 auto;padding:16px}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 12px}
.tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:var(--soft);cursor:pointer}
.tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001018;border-color:transparent}
.panel{display:none} .panel.active{display:block}
.card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
input,select,button,textarea{background:var(--soft);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
button{cursor:pointer;border:1px solid transparent;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001018;font-weight:700}
button.secondary{background:transparent;color:var(--text);border-color:var(--border)}
.small{font-size:12px;color:var(--muted)} .tag{padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--muted);display:inline-block}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border)}
summary{cursor:pointer}
hr{border:0;border-top:1px dashed var(--border);margin:10px 0}

/* Chat */
.chat-wrap{display:grid;grid-template-rows:1fr auto;gap:10px;height:min(68vh,620px)}
.msgs{overflow:auto;padding-right:4px}
.msg{display:flex;gap:10px;margin:10px 0}
.bubble{max-width:80%;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:var(--soft)}
.me .bubble{margin-left:auto;background:#112235}
.sensei .bubble{background:#0f1d24}
.quick{display:flex;gap:6px;flex-wrap:wrap}
.quick button{padding:6px 10px}

/* Charts */
canvas{width:100%;height:260px;background:var(--soft);border:1px solid var(--border);border-radius:12px;display:block}

/* Learn cards */
.grid{display:grid;gap:12px;grid-template-columns:1fr} @media(min-width:880px){.grid{grid-template-columns:1fr 1fr}}

/* Quiz */
.quiz-q{margin:10px 0} .opt{display:block;margin:6px 0}
.score{font-size:18px;font-weight:800}
</style>
</head>
<body>
<header>
  <h1>å¸«åŒ ã‚¢ãƒ—ãƒª v1 <span class="badge">æŠ•è³‡ãƒãƒ£ãƒƒãƒˆ</span> <span class="badge">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</span> <span class="badge">å­¦ç¿’ï¼†ã‚¯ã‚¤ã‚º</span></h1>
  <div class="sub">æ•™è‚²ç›®çš„ãƒ»ä¸€èˆ¬æƒ…å ±ã€‚ç‰¹å®šéŠ˜æŸ„ã®æ¨å¥¨ã¯è¡Œã„ã¾ã›ã‚“ï¼ˆé‡è¦æƒ…å ±ã¯å…è²¬å‚ç…§ï¼‰ã€‚</div>
</header>

<div class="container">
  <div class="tabs">
    <div class="tab active" data-tab="chat">ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</div>
    <div class="tab" data-tab="sim">ğŸ“Š ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
    <div class="tab" data-tab="learn">ğŸ“š å­¦ç¿’</div>
    <div class="tab" data-tab="quiz">ğŸ§ª ã‚¯ã‚¤ã‚º</div>
    <div class="tab" data-tab="profile">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
  </div>

  <!-- Chat -->
  <section id="chat" class="panel active">
    <div class="card chat-wrap">
      <div id="msgs" class="msgs"></div>
      <div>
        <div class="quick">
          <button class="secondary q">NISAã£ã¦ä½•è²·ãˆã°ï¼Ÿ</button>
          <button class="secondary q">å€‹åˆ¥æ ªã©ã†ï¼Ÿ</button>
          <button class="secondary q">ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³è²·ã†ã¹ãï¼Ÿ</button>
          <button class="secondary q">FXã§å¢—ã‚„ã›ã‚‹ï¼Ÿ</button>
          <button class="secondary q">ä¸å‹•ç”£ã£ã¦ã‚ã‚Šï¼Ÿ</button>
        </div>
        <div class="row" style="margin-top:8px">
          <input id="chatInput" placeholder="å¸«åŒ ã«è³ªå•ã‚’æ›¸ãï¼ˆä¾‹ï¼šæ¯æœˆ1ä¸‡å††ã§ä½•ã‚„ã‚Œã°ï¼Ÿï¼‰" style="flex:1">
          <button id="sendBtn">é€ä¿¡</button>
        </div>
        <div class="small">â€» ã“ã®ã‚¢ãƒ—ãƒªã®å›ç­”ã¯ä¸€èˆ¬çš„æƒ…å ±ã§ã‚ã‚Šã€æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è‡ªå·±è²¬ä»»ã§ã”åˆ¤æ–­ãã ã•ã„ã€‚</div>
      </div>
    </div>
  </section>

  <!-- Simulator -->
  <section id="sim" class="panel">
    <div class="card">
      <h2 style="margin:0 0 8px">NISA / ç©ç«‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
      <div class="row">
        <div><label>æ¯æœˆã®ç©ç«‹(å††)</label><input id="pmtN" type="number" value="30000"></div>
        <div><label>å¹´ç‡ãƒªã‚¿ãƒ¼ãƒ³(%)</label><input id="retN" type="number" value="5"></div>
        <div><label>å¹´æ•°</label><input id="yrsN" type="number" value="10"></div>
        <div><label>ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£(å¹´, %)*</label><input id="volN" type="number" value="0"></div>
        <button id="runN" class="secondary">è¨ˆç®—</button>
      </div>
      <div class="small">*ãƒœãƒ©0=æ±ºå®šè«–ã€‚>0ã«ã™ã‚‹ã¨ä¹±æ•°ã§ã–ã£ãã‚Šåˆ†æ•£ï¼ˆæ“¬ä¼¼ï¼‰ã€‚</div>
      <div class="row" style="margin-top:6px">
        <div class="tag" id="outN"></div>
      </div>
      <canvas id="chartN"></canvas>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px">Crypto DCAï¼ˆãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ç­‰ï¼‰</h2>
      <div class="row">
        <div><label>æ¯æœˆã®è³¼å…¥(å††)</label><input id="pmtC" type="number" value="10000"></div>
        <div><label>æœŸå¾…å¹´ç‡(%)</label><input id="retC" type="number" value="20"></div>
        <div><label>å¹´æ•°</label><input id="yrsC" type="number" value="5"></div>
        <div><label>ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£(å¹´, %)</label><input id="volC" type="number" value="60"></div>
        <button id="runC" class="secondary">è¨ˆç®—</button>
      </div>
      <div class="row" style="margin-top:6px">
        <div class="tag" id="outC"></div>
      </div>
      <canvas id="chartC"></canvas>
      <div class="small">æ³¨: ã‚¯ãƒªãƒ—ãƒˆã¯ä¾¡æ ¼å¤‰å‹•ãŒæ¥µç«¯ã«å¤§ãã„è³‡ç”£ã€‚é•·æœŸç©ç«‹ã§ã‚‚**å°‘é¡ãƒ»åˆ†æ•£**ãŒåŸºæœ¬ã€‚</div>
    </div>
  </section>

  <!-- Learn -->
  <section id="learn" class="panel">
    <div class="grid">
      <div class="card">
        <h3 style="margin:0 0 6px">NISAã®è€ƒãˆæ–¹ï¼ˆè¶…è¦ç´„ï¼‰</h3>
        <ul class="small">
          <li>é•·æœŸãƒ»åˆ†æ•£ãƒ»ä½ã‚³ã‚¹ãƒˆã®**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**ã‚’è»¸ã«ã€‚</li>
          <li>æ¯æœˆä¸€å®šé¡ã‚’**æ™‚é–“åˆ†æ•£**ï¼ˆDCAï¼‰ã€‚</li>
          <li>æš´è½æ™‚ã‚‚**ãƒ«ãƒ¼ãƒ«ç¶™ç¶š**ï¼ˆå£²ã‚‰ãªã„ï¼‰ã€‚</li>
        </ul>
        <details><summary>ã‚‚ã†å°‘ã—è©³ã—ã</summary>
          <p class="small">ãƒ»åºƒã„åˆ†æ•£ï¼ˆå…¨ä¸–ç•Œ/å…ˆé€²å›½/å›½å†…ãªã©ã®æŒ‡æ•°ï¼‰<br>ãƒ»ä¿¡è¨—å ±é…¬ãŒä½ã„ETF/æŠ•ä¿¡<br>ãƒ»ç¨åˆ¶ãŒæœ‰åˆ©ãªæ ï¼ˆNISAï¼‰ã‚’å„ªå…ˆæ´»ç”¨</p>
        </details>
      </div>
      <div class="card">
        <h3 style="margin:0 0 6px">ãƒªã‚¹ã‚¯ç®¡ç†ã®é‰„å‰‡</h3>
        <ul class="small">
          <li>ç”Ÿæ´»é˜²è¡›è³‡é‡‘ï¼ˆ3ã€œ6ã‹æœˆï¼‰ã‚’**åˆ¥å£**ã§ç¢ºä¿ã€‚</li>
          <li>ãƒã‚¤ãƒªã‚¹ã‚¯è³‡ç”£ï¼ˆå€‹åˆ¥æ ª/FX/ä»®æƒ³é€šè²¨ï¼‰ã¯**è³‡ç”£ã®ä¸€éƒ¨ã ã‘**ã€‚</li>
          <li>ãƒ¬ãƒãƒ¬ãƒƒã‚¸ã¯**å°ã•ããƒ»çŸ­æœŸé™å®š**ã€‚</li>
        </ul>
      </div>
      <div class="card">
        <h3 style="margin:0 0 6px">ã‚¤ãƒ³ãƒ•ãƒ¬ã¨è¤‡åˆ©</h3>
        <p class="small">è¤‡åˆ©ã¯ã€Œæ™‚é–“Ã—å†æŠ•è³‡ã€ã€‚å¹´5%ã‚’10å¹´ç©ã¿ä¸Šã’ã‚‹ã¨ã€å…ƒæœ¬ã®**ç´„1.63å€**ã€‚20å¹´ãªã‚‰**ç´„2.65å€**ã€‚</p>
      </div>
      <div class="card">
        <h3 style="margin:0 0 6px">ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´</h3>
        <ul class="small"><li>çŸ­æœŸã®å€¤å‹•ãã§**ã‚„ã‚ã‚‹**</li><li>æ‰‹æ•°æ–™ã®é«˜ã„å•†å“</li><li>é›†ä¸­æŠ•è³‡ï¼ˆå˜ä¸€ãƒ†ãƒ¼ãƒ/éŠ˜æŸ„ï¼‰</li></ul>
      </div>
    </div>
  </section>

  <!-- Quiz -->
  <section id="quiz" class="panel">
    <div class="card">
      <h2 style="margin:0 0 6px">ãƒŸãƒ‹ã‚¯ã‚¤ã‚ºï¼ˆ5å•ï¼‰</h2>
      <div id="quizBox"></div>
      <button id="grade" class="secondary">æ¡ç‚¹ã™ã‚‹</button>
      <div id="score" class="score" style="margin-top:8px"></div>
    </div>
  </section>

  <!-- Profile -->
  <section id="profile" class="panel">
    <div class="card">
      <h2 style="margin:0 0 6px">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå›ç­”ã«åæ˜ ï¼‰</h2>
      <div class="row">
        <div><label>å¹´é½¢</label><input id="age" type="number" value="20"></div>
        <div><label>æŠ•è³‡æœŸé–“ï¼ˆå¹´ï¼‰</label><input id="horizon" type="number" value="10"></div>
        <div><label>æ¯æœˆã®æŠ•è³‡ä½™åŠ›ï¼ˆå††ï¼‰</label><input id="budget" type="number" value="10000"></div>
        <div><label>ãƒªã‚¹ã‚¯è¨±å®¹åº¦</label>
          <select id="risk"><option>ä½</option><option selected>ä¸­</option><option>é«˜</option></select>
        </div>
        <button id="saveProf" class="secondary">ä¿å­˜</button>
      </div>
      <div class="small" id="profOut"></div>
    </div>
    <div class="card">
      <h3 style="margin:0 0 4px">å…è²¬</h3>
      <p class="small">ã“ã®ã‚¢ãƒ—ãƒªã¯æ•™è‚²ç›®çš„ã®ä¸€èˆ¬æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚ç‰¹å®šã®é‡‘èå•†å“ã‚„æŠ•è³‡è¡Œå‹•ã®æ¨å¥¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ã§è¡Œã£ã¦ãã ã•ã„ã€‚å¿…è¦ãªã‚‰ã°é‡‘èåºç™»éŒ²ã®å°‚é–€å®¶ã¸ç›¸è«‡ã—ã¦ãã ã•ã„ã€‚</p>
    </div>
  </section>
</div>

<script>
/* ========= Tabs ========= */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    t.classList.add('active');
    document.getElementById(t.dataset.tab).classList.add('active');
  });
});

/* ========= Profile ========= */
const PK='mentor_profile_v1';
let PROF = JSON.parse(localStorage.getItem(PK)||'{"age":20,"horizon":10,"budget":10000,"risk":"ä¸­"}');
function saveProf(){ localStorage.setItem(PK, JSON.stringify(PROF)); showProf(); }
function showProf(){ document.getElementById('profOut').textContent = `å¹´é½¢:${PROF.age} / æœŸé–“:${PROF.horizon}å¹´ / ä½™åŠ›:Â¥${(+PROF.budget).toLocaleString()} / ãƒªã‚¹ã‚¯:${PROF.risk}`; }
['age','horizon','budget','risk'].forEach(id=> document.getElementById(id).value = PROF[id]);
document.getElementById('saveProf').addEventListener('click', ()=>{
  PROF.age=+document.getElementById('age').value||20;
  PROF.horizon=+document.getElementById('horizon').value||10;
  PROF.budget=+document.getElementById('budget').value||0;
  PROF.risk=document.getElementById('risk').value||'ä¸­';
  saveProf();
});
showProf();

/* ========= Chat ========= */
const msgs = document.getElementById('msgs');
function addMsg(role, text){
  const wrap = document.createElement('div');
  wrap.className = 'msg '+(role==='me'?'me':'sensei');
  const bub = document.createElement('div');
  bub.className = 'bubble';
  bub.innerHTML = text;
  wrap.appendChild(bub);
  msgs.appendChild(wrap);
  msgs.scrollTop = msgs.scrollHeight;
}
function adviceFor(input){
  const q = input.toLowerCase();
  const {age,horizon,budget,risk} = PROF;
  const base = `<div class="small">å‰æ: æœŸé–“<strong>${horizon}å¹´</strong> / æœˆ<strong>Â¥${(+budget).toLocaleString()}</strong> / ãƒªã‚¹ã‚¯<strong>${risk}</strong></div><hr>`;
  const rules = `<ul class="small"><li>ç”Ÿæ´»é˜²è¡›è³‡é‡‘ï¼ˆ3â€“6ã‹æœˆï¼‰ã‚’åˆ¥å£ã§ç¢ºä¿</li><li>é•·æœŸãƒ»åˆ†æ•£ãƒ»ä½ã‚³ã‚¹ãƒˆã‚’è»¸ã«ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹/DCAï¼‰</li><li>é«˜ãƒœãƒ©è³‡ç”£ã¯å°‘é¡ãƒ»ä¸Šé™ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’æ±ºã‚ã‚‹</li></ul>`;

  if(q.includes('nisa') || q.includes('ã¤ã¿ãŸã¦') || q.includes('ç©ç«‹')){
    return base + `<b>æ–¹å‘æ€§ï¼š</b>ã¾ãšã¯NISAæ ã§<strong>åºƒãåˆ†æ•£ã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹</strong>ã‚’ä¸­å¿ƒã«ã€æ¯æœˆã®è‡ªå‹•ç©ç«‹ã€‚<br>
    ãƒ»é…åˆ†ä¾‹ï¼ˆå‚è€ƒï¼‰: æ ªå¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ 80% / å‚µåˆ¸ã‚„ç¾é‡‘ 20%ï¼ˆ${risk==='é«˜'?'æ ªå¼å¤šã‚':'ä¸­'===risk?'ä¸­åº¸':'å®‰å®šé‡è¦–'}ï¼‰<br>
    ãƒ»${horizon>=10?'é•·æœŸæœ‰åˆ©ã€‚':'æœŸé–“ãŒçŸ­ã‚ãªã®ã§ä¾¡æ ¼å¤‰å‹•ã«æ³¨æ„ã€‚'}<br>${rules}`;
  }
  if(q.includes('å€‹åˆ¥') || q.includes('æ ª')){
    return base + `<b>å€‹åˆ¥æ ªï¼š</b>ä¼æ¥­åˆ†æãŒå¿…è¦ã€‚æœ€åˆã¯<strong>å…¨ä½“ã®ä¸€éƒ¨(ä¾‹: ã€œ20%)</strong>ã«é™å®šã€‚<br>
    ãƒ»åˆ†æ•£ï¼ˆæ¥­ç¨®/åœ°åŸŸï¼‰ãƒ»æ‰‹æ•°æ–™ãƒ»ç¨åˆ¶ã‚’æ„è­˜<br>ãƒ»æŒ‡æ•°é€£å‹•ã¨ä½µç”¨ã§ãƒªã‚¹ã‚¯ã‚’æŠ‘ãˆã‚‹<br>${rules}`;
  }
  if(q.includes('fx') || q.includes('ãƒ¬ãƒ') || q.includes('ç‚ºæ›¿')){
    return base + `<b>FXï¼š</b>ãƒ¬ãƒãƒ¬ãƒƒã‚¸ã¨å¼·åˆ¶æ±ºæ¸ˆãƒªã‚¹ã‚¯ãŒã‚ã‚Šã€<strong>çŸ­æœŸãƒ»å°‘é¡</strong>ã«é™å®šãŒç„¡é›£ã€‚ã‚¹ãƒ¯ãƒƒãƒ—/æ‰‹æ•°æ–™ãƒ»æåˆ‡ã‚Šãƒ«ãƒ¼ãƒ«å¿…é ˆã€‚<br>${rules}`;
  }
  if(q.includes('ãƒ“ãƒƒãƒˆ') || q.includes('btc') || q.includes('ä»®æƒ³')){
    return base + `<b>ä»®æƒ³é€šè²¨ï¼š</b>æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³ã¯é«˜ã„ãŒ<strong>å¤§ããä¸Šä¸‹</strong>ã€‚<br>
    ãƒ»DCAï¼ˆå®šé¡ç©ç«‹ï¼‰/ ä¸Šé™å‰²åˆï¼ˆä¾‹: ç·è³‡ç”£ã®5â€“10%ä»¥å†…ï¼‰<br>ãƒ»é•·æœŸã§ä¿æœ‰ã™ã‚‹è¦šæ‚Ÿã¨åˆ†æ•£ã‚’ã€‚<br>${rules}`;
  }
  if(q.includes('ä¸å‹•ç”£') || q.includes('è³ƒè²¸') || q.includes('åˆ©å›ã‚Š')){
    return base + `<b>ä¸å‹•ç”£ï¼š</b>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ãƒ»é‡‘åˆ©ãƒ»ç©ºå®¤ç‡ãƒ»ä¿®ç¹•è²»ã‚’ã‚·ãƒ“ã‚¢ã«è©¦ç®—ã€‚<br>
    ãƒ»å€Ÿå…¥ã®å›ºå®š/å¤‰å‹•é‡‘åˆ©ã¨è¿”æ¸ˆæ¯”ç‡ã‚’ç®¡ç†<br>ãƒ»åœ°åŸŸ/ç‰©ä»¶ã‚¿ã‚¤ãƒ—ã®åˆ†æ•£ã‚‚æ¤œè¨<br>${rules}`;
  }
  if(q.includes('ãƒãƒ¼ãƒˆ') || q.includes('é…åˆ†') || q.includes('ã‚¢ãƒ­ã‚±')){
    const eq = risk==='é«˜'?80:risk==='ä¸­'?60:40;
    return base + `<b>é…åˆ†ã®ãŸãŸãå°ï¼š</b>æ ªå¼ ${eq}% / å®‰å®šè³‡ç”£ ${100-eq}%ï¼ˆæœŸé–“${horizon}å¹´ï¼‰<br>
    ãƒ»å¹´1å›ã®ãƒªãƒãƒ©ãƒ³ã‚¹ã§æ¯”ç‡ã‚’ç¶­æŒ<br>${rules}`;
  }
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  return base + `çŠ¶æ³ã‚’æ•™ãˆã¦ãã‚ŒãŸã‚‰ã€æŒ‡é‡ã‚’å‡ºã™ã§ï¼<br>
  â‘ ç›®çš„ï¼ˆå®¶ãƒ»æ•™è‚²ãƒ»è€å¾Œ etc.ï¼‰â‘¡æœŸé–“ï¼ˆ${horizon}å¹´ã§OKï¼Ÿï¼‰â‘¢æ¯æœˆã®ä½™åŠ›ï¼ˆä»Šã¯Â¥${(+budget).toLocaleString()}ï¼‰â‘£çµŒé¨“ãƒ»ä¸å®‰ç‚¹<br>${rules}`;
}
function send(text){
  if(!text.trim()) return;
  addMsg('me', text);
  setTimeout(()=> addMsg('sensei', adviceFor(text)), 200);
}
document.getElementById('sendBtn').addEventListener('click', ()=> send(document.getElementById('chatInput').value));
document.getElementById('chatInput').addEventListener('keydown', e=>{ if(e.key==='Enter'){ send(e.target.value); e.target.value=''; }});
document.querySelectorAll('.q').forEach(b=> b.addEventListener('click',()=> send(b.textContent)));
addMsg('sensei', 'ã‚ˆã†ãƒ©ã‚¹ï¼æŠ•è³‡ã®ç–‘å•ã‚’æŠ•ã’ã¦ãã‚ŒãŸã‚‰ã€ä¸€ç·’ã«è€ƒãˆã‚‹ã§ã€‚ã¾ãšã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ã€ŒğŸ‘¤ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€ã§è»½ãåŸ‹ã‚ã‚‹ã®ãŒãŠã™ã™ã‚ã€‚');

/* ========= Simulator ========= */
function drawLine(canvas, series, labels){
  const ctx=canvas.getContext('2d'); const DPR=window.devicePixelRatio||1; const W=canvas.clientWidth, H=canvas.clientHeight;
  canvas.width=W*DPR; canvas.height=H*DPR; ctx.scale(DPR,DPR); ctx.clearRect(0,0,W,H);
  const pad=36; const maxY=Math.max(...series)*1.05||1; const minY=0;
  // axes
  ctx.strokeStyle="#233043"; ctx.beginPath(); ctx.moveTo(pad,H-pad); ctx.lineTo(W-pad,H-pad); ctx.lineTo(W-pad,pad); ctx.stroke();
  // grid
  ctx.fillStyle="#9fb3c8"; ctx.font="12px system-ui";
  for(let t=0;t<=4;t++){ const y=H-pad-(H-2*pad)*t/4; const val=Math.round(minY+(maxY-minY)*t/4);
    ctx.fillText(val.toLocaleString("ja-JP"),6,y+4); ctx.strokeStyle="#233043"; ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(W-pad,y); ctx.stroke(); }
  // line
  ctx.beginPath(); series.forEach((v,i)=>{ const x=pad + (W-2*pad)*i/(series.length-1); const y=H-pad-(H-2*pad)*((v-minY)/(maxY-minY)); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });
  ctx.strokeStyle="#7aa2ff"; ctx.lineWidth=2; ctx.stroke();
  // labels (start/end)
  ctx.fillStyle="#e8f0ff"; ctx.fillText(labels[0], pad, H-pad+16);
  ctx.fillText(labels[labels.length-1], W-pad-60, H-pad+16);
}

function runDCA(monthly, yrs, annual, vol=0){
  const N = Math.max(1, Math.round(yrs*12));
  const r_m = (annual/100)/12;
  const vol_m = (vol/100)/Math.sqrt(12);
  let v=0, arr=[];
  for(let i=1;i<=N;i++){
    // ãƒ©ãƒ³ãƒ€ãƒ ãƒªã‚¿ãƒ¼ãƒ³ï¼ˆlognormalè¿‘ä¼¼ï¼‰
    const drift = r_m - 0.5*vol_m*vol_m;
    const shock = vol>0 ? Math.exp(drift + vol_m*randn()) : (1+r_m);
    v = (v+monthly) * (vol>0 ? shock : (1+r_m));
    arr.push(Math.round(v));
  }
  return arr;
}
function randn(){ // Box-Muller
  let u=0,v=0; while(u===0) u=Math.random(); while(v===0) v=Math.random(); return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v);
}
function fmtMoney(y){ return "Â¥"+Math.round(y).toLocaleString("ja-JP"); }

document.getElementById('runN').addEventListener('click', ()=>{
  const m=+document.getElementById('pmtN').value||0;
  const r=+document.getElementById('retN').value||0;
  const y=+document.getElementById('yrsN').value||0;
  const vol=+document.getElementById('volN').value||0;
  const arr = runDCA(m,y,r,vol);
  const total = m * Math.round(y*12);
  const last = arr[arr.length-1]||0;
  document.getElementById('outN').textContent = `å…ƒæœ¬ ${fmtMoney(total)} / è©•ä¾¡é¡ ${fmtMoney(last)} / åˆ©ç›Š ${fmtMoney(last-total)}`;
  drawLine(document.getElementById('chartN'), arr, ["é–‹å§‹","çµ‚äº†"]);
});

document.getElementById('runC').addEventListener('click', ()=>{
  const m=+document.getElementById('pmtC').value||0;
  const r=+document.getElementById('retC').value||0;
  const y=+document.getElementById('yrsC').value||0;
  const vol=+document.getElementById('volC').value||0;
  const arr = runDCA(m,y,r,vol);
  const total = m * Math.round(y*12);
  const last = arr[arr.length-1]||0;
  document.getElementById('outC').textContent = `å…ƒæœ¬ ${fmtMoney(total)} / è©•ä¾¡é¡ ${fmtMoney(last)} / åˆ©ç›Š ${fmtMoney(last-total)}`;
  drawLine(document.getElementById('chartC'), arr, ["é–‹å§‹","çµ‚äº†"]);
});

/* ========= Quiz ========= */
const QA = [
  {q:"NISAã§åŸºæœ¬çš„ã«ç‹™ã†ã¹ãæ–¹é‡ã¯ã©ã‚Œï¼Ÿ", a:["çŸ­æœŸå£²è²·ã§åˆ©ç›Šç¢ºå®š","é•·æœŸãƒ»åˆ†æ•£ãƒ»ä½ã‚³ã‚¹ãƒˆ","ä¸€ç‚¹é›†ä¸­ã§å¤§å‹ã¡"], c:1},
  {q:"DCAï¼ˆãƒ‰ãƒ«ã‚³ã‚¹ãƒˆå¹³å‡æ³•ï¼‰ã®èª¬æ˜ã§æ­£ã—ã„ã®ã¯ï¼Ÿ", a:["æ¯æœˆä¸€å®šé¡ã‚’è²·ã†","æœ€å®‰ã®æ—¥ã ã‘è²·ã†","ãƒœãƒ¼ãƒŠã‚¹ã®æ™‚ã ã‘è²·ã†"], c:0},
  {q:"é«˜ãƒœãƒ©è³‡ç”£ã«å¯¾ã™ã‚‹å§¿å‹¢ã¨ã—ã¦é©åˆ‡ãªã®ã¯ï¼Ÿ", a:["è³‡ç”£ã®å¤§åŠã‚’å…¥ã‚Œã‚‹","å€Ÿé‡‘ã—ã¦å…¨åŠ›","ä¸Šé™å‰²åˆã‚’æ±ºã‚å°‘é¡ã§"], c:2},
  {q:"ç”Ÿæ´»é˜²è¡›è³‡é‡‘ã¨ã—ã¦é©åˆ‡ãªã®ã¯ï¼Ÿ", a:["1é€±é–“åˆ†","3ã€œ6ã‹æœˆåˆ†","10å¹´åˆ†"], c:1},
  {q:"æ‰‹æ•°æ–™ãŒåŒã˜ãªã‚‰ã€åˆ†æ•£ãŒåºƒã„å•†å“ã¯ï¼Ÿ", a:["å˜ä¸€éŠ˜æŸ„","ãƒ†ãƒ¼ãƒç‰¹åŒ–ETF","å…¨ä¸–ç•Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹"], c:2},
];
function renderQuiz(){
  const box=document.getElementById('quizBox'); box.innerHTML="";
  QA.forEach((it,i)=>{
    const div=document.createElement('div'); div.className="quiz-q";
    div.innerHTML = `<div>${i+1}. ${it.q}</div>` + it.a.map((t,j)=>`<label class="opt"><input type="radio" name="q${i}" value="${j}"> ${t}</label>`).join("");
    box.appendChild(div);
  });
}
document.getElementById('grade').addEventListener('click', ()=>{
  let score=0; QA.forEach((it,i)=>{ const v = document.querySelector(`input[name="q${i}"]:checked`); if(v && +v.value===it.c) score++; });
  document.getElementById('score').textContent = `æ­£è§£ï¼š${score}/${QA.length}ç‚¹`;
});
renderQuiz();

/* ========= PWA SW ========= */
if('serviceWorker' in navigator){ window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js').catch(console.error)); }
</script>
</body>
</html>
